<!DOCTYPE html>
<html lang="en">

<head>
    <title>
        <%= title %> - SURF Articles
    </title>
    <link rel="icon" type="image/png" href="/brand/favicon.png">
    <meta name="description" content="<%= description %>">
    <%- include('../partials/head') %>
        <style>
            .app-main {
                padding: 0;
            }

            .blog-hero {
                width: 100%;
                height: 220px;
                background: linear-gradient(135deg, rgba(124, 58, 237, 0.4) 0%, rgba(0, 212, 255, 0.3) 100%);
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .blog-hero .hero-icon {
                font-size: 5rem;
            }

            .blog-container {
                max-width: 780px;
                margin: 0 auto;
                padding: 2.5rem 2rem 4rem;
            }

            .blog-post-header {
                margin-bottom: 2.5rem;
                text-align: center;
            }

            .blog-meta {
                font-size: 0.8rem;
                text-transform: uppercase;
                letter-spacing: 0.05em;
                margin-bottom: 0.75rem;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 0.5rem;
            }

            .blog-meta .category-badge {
                background: rgba(124, 58, 237, 0.25);
                color: var(--accent-purple-light);
                padding: 0.2rem 0.6rem;
                border-radius: 6px;
                font-weight: 600;
            }

            .blog-meta .date,
            .blog-meta .read-time {
                color: var(--text-muted);
            }

            .blog-post-header h1 {
                font-size: 2rem;
                line-height: 1.2;
                margin: 0.5rem 0;
                background: var(--gradient-primary);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
            }

            .subtitle {
                font-size: 1.05rem;
                color: var(--text-secondary);
                margin: 0;
            }

            .blog-content h2 {
                font-size: 1.5rem;
                margin: 2.5rem 0 1rem;
                padding-bottom: 0.5rem;
                border-bottom: 1px solid var(--border-color);
                color: var(--accent-cyan);
            }

            .blog-content h3 {
                font-size: 1.15rem;
                margin: 1.5rem 0 0.75rem;
                color: var(--accent-purple-light);
            }

            .blog-content p {
                line-height: 1.8;
                color: var(--text-secondary);
                margin-bottom: 1rem;
            }

            .blog-content ul,
            .blog-content ol {
                margin: 0.75rem 0 1rem 1.5rem;
                color: var(--text-secondary);
                line-height: 1.8;
            }

            .blog-content li {
                margin-bottom: 0.3rem;
            }

            .blog-content strong {
                color: var(--text-primary);
            }

            .blog-content code {
                background: rgba(0, 212, 255, 0.1);
                color: var(--accent-cyan);
                padding: 0.15rem 0.4rem;
                border-radius: 4px;
                font-size: 0.88em;
                font-family: 'SF Mono', 'Fira Code', monospace;
            }

            /* Code blocks */
            .code-block {
                background: rgba(0, 0, 0, 0.35);
                border: 1px solid var(--border-color);
                border-radius: 10px;
                margin: 1rem 0 1.5rem;
                overflow: hidden;
            }

            .code-block-header {
                background: rgba(0, 0, 0, 0.3);
                padding: 0.5rem 1rem;
                font-size: 0.75rem;
                color: var(--text-muted);
                font-family: 'SF Mono', monospace;
                border-bottom: 1px solid var(--border-color);
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }

            .code-block-header .dot {
                width: 8px;
                height: 8px;
                border-radius: 50%;
                display: inline-block;
            }

            .code-block-header .dot.red {
                background: #ff5f57;
            }

            .code-block-header .dot.yellow {
                background: #ffbd2e;
            }

            .code-block-header .dot.green {
                background: #28c840;
            }

            .code-block pre {
                padding: 1rem 1.25rem;
                margin: 0;
                overflow-x: auto;
                font-size: 0.85rem;
                line-height: 1.6;
                font-family: 'SF Mono', 'Fira Code', monospace;
                color: #e0e0e0;
            }

            .code-block .comment {
                color: #6a737d;
            }

            .code-block .keyword {
                color: #c678dd;
            }

            .code-block .string {
                color: #98c379;
            }

            .code-block .tag {
                color: #e06c75;
            }

            .code-block .attr {
                color: #d19a66;
            }

            .code-block .fn {
                color: #61afef;
            }

            .code-block .const {
                color: #d19a66;
            }

            /* Highlight boxes */
            .highlight-box {
                background: rgba(0, 212, 255, 0.06);
                border-left: 3px solid var(--accent-cyan);
                padding: 1rem 1.25rem;
                border-radius: 0 8px 8px 0;
                margin: 1.25rem 0;
                font-size: 0.95rem;
                color: var(--text-secondary);
            }

            .highlight-box strong {
                color: var(--accent-cyan);
            }

            .highlight-box.purple {
                background: rgba(124, 58, 237, 0.08);
                border-left-color: var(--accent-purple);
                padding: 1rem 1.25rem;
                border-radius: 0 8px 8px 0;
                margin: 1.25rem 0;
                font-size: 0.95rem;
                color: var(--text-secondary);
            }

            .highlight-box.purple strong {
                color: var(--accent-purple-light);
            }

            /* Module card */
            .module-card {
                background: rgba(255, 255, 255, 0.03);
                border: 1px solid var(--border-color);
                border-radius: 12px;
                padding: 1.5rem;
                margin: 1.25rem 0;
            }

            .module-card h4 {
                color: var(--accent-cyan);
                margin: 0 0 0.5rem;
                font-size: 1rem;
            }

            .module-card p {
                margin-bottom: 0.5rem;
            }

            /* Table of contents */
            .table-of-contents {
                background: rgba(0, 0, 0, 0.2);
                border: 1px solid var(--border-color);
                border-radius: 12px;
                padding: 1.25rem 1.5rem;
                margin-bottom: 2rem;
            }

            .table-of-contents h3 {
                margin: 0 0 0.75rem;
                font-size: 0.9rem;
                text-transform: uppercase;
                letter-spacing: 0.05em;
                color: var(--text-muted);
            }

            .table-of-contents ol {
                margin: 0;
                padding-left: 1.25rem;
            }

            .table-of-contents li {
                margin-bottom: 0.3rem;
            }

            .table-of-contents a {
                color: var(--accent-purple-light);
                text-decoration: none;
                font-size: 0.9rem;
            }

            .table-of-contents a:hover {
                color: var(--accent-cyan);
            }

            /* Architecture grid */
            .arch-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 1rem;
                margin: 1.25rem 0;
            }

            .arch-card {
                background: rgba(0, 212, 255, 0.05);
                border: 1px solid rgba(0, 212, 255, 0.15);
                padding: 1.25rem;
                border-radius: 12px;
                text-align: center;
            }

            .arch-card h4 {
                font-size: 1.1rem;
                margin: 0 0 0.35rem;
                color: var(--accent-cyan);
            }

            .arch-card p {
                color: var(--text-secondary);
                font-size: 0.88rem;
                margin: 0;
            }

            /* Flow diagram (inline) */
            .flow-diagram {
                background: rgba(0, 0, 0, 0.25);
                border: 1px solid var(--border-color);
                border-radius: 12px;
                padding: 1.5rem;
                margin: 1.25rem 0;
                text-align: center;
                font-family: 'SF Mono', monospace;
                font-size: 0.85rem;
                line-height: 1.8;
                color: var(--text-secondary);
            }

            .flow-diagram .arrow {
                color: var(--accent-cyan);
                margin: 0 0.25rem;
            }

            .flow-diagram .module-name {
                background: rgba(124, 58, 237, 0.2);
                color: var(--accent-purple-light);
                padding: 0.2rem 0.5rem;
                border-radius: 4px;
                font-weight: 600;
            }

            /* Dependency graph ‚Äî proper grid layout */
            .dep-graph {
                background: rgba(0, 0, 0, 0.25);
                border: 1px solid var(--border-color);
                border-radius: 12px;
                padding: 2rem 1.5rem;
                margin: 1.25rem 0;
            }

            .dep-graph-title {
                text-align: center;
                color: var(--accent-purple-light);
                font-weight: 700;
                font-size: 0.95rem;
                margin-bottom: 1.5rem;
            }

            .dep-row {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 0.5rem;
                margin-bottom: 0.75rem;
                flex-wrap: wrap;
            }

            .dep-node {
                background: rgba(124, 58, 237, 0.2);
                color: var(--accent-purple-light);
                padding: 0.4rem 0.85rem;
                border-radius: 8px;
                font-weight: 600;
                font-family: 'SF Mono', monospace;
                font-size: 0.82rem;
                border: 1px solid rgba(124, 58, 237, 0.3);
                white-space: nowrap;
            }

            .dep-node.primary {
                background: rgba(0, 212, 255, 0.12);
                color: var(--accent-cyan);
                border-color: rgba(0, 212, 255, 0.3);
                font-size: 0.9rem;
                padding: 0.5rem 1rem;
            }

            .dep-node.standalone {
                background: rgba(255, 255, 255, 0.05);
                color: var(--text-muted);
                border-color: rgba(255, 255, 255, 0.1);
            }

            .dep-arrow {
                color: var(--accent-cyan);
                font-size: 1.1rem;
                flex-shrink: 0;
            }

            .dep-arrow.down {
                display: block;
                text-align: center;
                margin: 0.25rem 0;
                font-size: 1rem;
            }

            .dep-label {
                color: var(--text-muted);
                font-size: 0.72rem;
                font-family: 'SF Mono', monospace;
                text-align: center;
                margin-top: -0.3rem;
                margin-bottom: 0.5rem;
            }

            .dep-branches {
                display: flex;
                justify-content: center;
                gap: 2.5rem;
                margin-top: 0.25rem;
            }

            .dep-branch {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 0.25rem;
            }

            /* Quote card */
            .quote-card {
                background: rgba(124, 58, 237, 0.08);
                border: 1px solid rgba(124, 58, 237, 0.2);
                border-radius: 12px;
                padding: 1.25rem 1.5rem;
                margin: 1.5rem 0;
                text-align: center;
            }

            .quote-card blockquote {
                margin: 0;
                font-style: italic;
                color: var(--accent-purple-light);
                font-size: 1.05rem;
                line-height: 1.6;
            }

            @media (max-width: 768px) {
                .arch-grid {
                    grid-template-columns: 1fr;
                }

                .blog-container {
                    padding: 1.5rem 1rem 3rem;
                }
            }
        </style>
</head>

<body>
    <div class="app-layout">
        <%- include('../partials/header') %>
            <%- include('../partials/sidebar', { activeCategory: null, activeExample: null }) %>

                <main class="app-main">
                    <div class="blog-hero">
                        <span class="hero-icon">üèóÔ∏è</span>
                    </div>

                    <div class="blog-container">
                        <header class="blog-post-header">
                            <div class="blog-meta">
                                <span class="category-badge">
                                    <%= category %>
                                </span>
                                <span class="date">‚Ä¢</span>
                                <span class="date">
                                    <%= date %>
                                </span>
                                <span class="read-time">‚Ä¢</span>
                                <span class="read-time">
                                    <%= readTime %>
                                </span>
                            </div>
                            <h1>
                                <%= title %>
                            </h1>
                            <p class="subtitle">Let's explore each module one by one: what it does, how it works, and
                                why it was designed this way.</p>
                        </header>

                        <article class="blog-content">
                            <nav class="table-of-contents">
                                <h3>Table of Contents</h3>
                                <ol>
                                    <li><a href="#overview">The Big Picture</a></li>
                                    <li><a href="#cell">Cell ‚Äî Local State Container</a></li>
                                    <li><a href="#signal">Signal ‚Äî Reactive Bindings</a></li>
                                    <li><a href="#surface">Surface ‚Äî DOM Regions</a></li>
                                    <li><a href="#patch">Patch ‚Äî Multi-Surface Updates</a></li>
                                    <li><a href="#pulse">Pulse ‚Äî Server Interactions</a></li>
                                    <li><a href="#echo">Echo ‚Äî State Preservation</a></li>
                                    <li><a href="#surf">Surf ‚Äî The Orchestrator</a></li>
                                    <li><a href="#plugins">Plugin System</a></li>
                                    <li><a href="#flow">Data Flow: Putting It All Together</a></li>
                                </ol>
                            </nav>

                            <!-- Section 1: Overview -->
                            <section id="overview">
                                <h2>1. The Big Picture</h2>

                                <p>Surf is built on a single, radical idea:</p>

                                <div class="quote-card">
                                    <blockquote>"Surface changes, Cell lives."</blockquote>
                                </div>

                                <p>The <strong>server</strong> is the source of truth. HTML is the primary data format.
                                    The client handles only temporary, local interactions. When the server sends new
                                    HTML, Surf replaces DOM regions (<strong>Surfaces</strong>) while preserving local
                                    widget state (<strong>Cells</strong>).</p>

                                <p>The framework consists of <strong>6 core modules</strong>, each with a single
                                    responsibility:</p>

                                <div class="arch-grid">
                                    <div class="arch-card">
                                        <h4>üß¨ Cell</h4>
                                        <p>Local state container</p>
                                    </div>
                                    <div class="arch-card">
                                        <h4>‚ö° Signal</h4>
                                        <p>Reactive bindings & events</p>
                                    </div>
                                    <div class="arch-card">
                                        <h4>üñºÔ∏è Surface</h4>
                                        <p>Replaceable DOM regions</p>
                                    </div>
                                    <div class="arch-card">
                                        <h4>üì¶ Patch</h4>
                                        <p>Multi-surface server responses</p>
                                    </div>
                                    <div class="arch-card">
                                        <h4>üíì Pulse</h4>
                                        <p>Server interaction layer</p>
                                    </div>
                                    <div class="arch-card">
                                        <h4>üîÑ Echo</h4>
                                        <p>State preservation across updates</p>
                                    </div>
                                </div>

                                <p>Each module works independently, but together they form a powerful system. Let's
                                    examine each one in detail.</p>
                            </section>

                            <!-- Section 2: Cell -->
                            <section id="cell">
                                <h2>2. Cell ‚Äî Local State Container</h2>

                                <div class="highlight-box">
                                    <strong>Mental Model:</strong> A Cell is like a small post-it note attached to an
                                    HTML element. Even if the rest of the page changes, the note stays in place.
                                </div>

                                <p>Cell is the most fundamental building block of Surf. Any HTML element with a
                                    <code>d-cell</code> attribute gets its own local state. This state is connected to
                                    the DOM using a <strong>WeakMap</strong> ‚Äî it doesn't pollute the element and
                                    doesn't prevent garbage collection.
                                </p>

                                <h3>How to Use?</h3>

                                <div class="code-block">
                                    <div class="code-block-header">
                                        <span class="dot red"></span>
                                        <span class="dot yellow"></span>
                                        <span class="dot green"></span>
                                        HTML
                                    </div>
                                    <pre><span class="comment">&lt;!-- Define initial state with a seed expression --&gt;</span>
<span class="tag">&lt;div</span> <span class="attr">d-cell</span>=<span class="string">"count: 0, name: 'Surf'"</span><span class="tag">&gt;</span>
  <span class="comment">&lt;!-- This div now has { count: 0, name: 'Surf' } state --&gt;</span>
<span class="tag">&lt;/div&gt;</span></pre>
                                </div>

                                <h3>How does it work?</h3>

                                <div class="code-block">
                                    <div class="code-block-header">
                                        <span class="dot red"></span>
                                        <span class="dot yellow"></span>
                                        <span class="dot green"></span>
                                        cell.js ‚Äî Core Logic
                                    </div>
                                    <pre><span class="comment">// State is kept in a WeakMap ‚Äî it doesn't touch the DOM</span>
<span class="keyword">const</span> <span class="const">cellStates</span> = <span class="keyword">new</span> <span class="fn">WeakMap</span>();

<span class="comment">// ID-based Map for Echo support</span>
<span class="keyword">const</span> <span class="const">cellIdStates</span> = <span class="keyword">new</span> <span class="fn">Map</span>();

<span class="keyword">function</span> <span class="fn">init</span>(element) {
  <span class="comment">// 1. Is there a state preserved by Echo? If so, use it</span>
  <span class="keyword">if</span> (cellId && cellIdStates.<span class="fn">has</span>(cellId)) {
    <span class="keyword">return</span> cellIdStates.<span class="fn">get</span>(cellId);
  }

  <span class="comment">// 2. Otherwise, parse the seed expression</span>
  <span class="keyword">const</span> state = <span class="fn">parseSeed</span>(cellExpr);
  cellStates.<span class="fn">set</span>(element, state);
  <span class="keyword">return</span> state;
}</pre>
                                </div>

                                <h3>Key Design Decisions</h3>
                                <ul>
                                    <li><strong>Decentralized Storage:</strong> State is tied to the DOM element via
                                        <strong>WeakMap</strong> instead of a central global object. When the element is
                                        removed from the DOM, the state is automatically garbage collected.
                                    </li>
                                    <li><strong>Encapsulation:</strong> Each Cell manages its own state by default. This
                                        isolation keeps components predictable and side-effect free.</li>
                                    <li><strong>Universal Access (Emergency Hatch):</strong> While Cells are isolated,
                                        one can use the <code>Surf</code> API
                                        (<code>getState</code>/<code>setState</code>) to interact between Cells if
                                        needed. Note: Overuse of this may indicate a need for refactoring towards a more
                                        server-driven approach.</li>
                                    <li><strong>Dual Storage:</strong> Internal use of <code>cellStates</code>
                                        (element‚Üístate) and <code>cellIdStates</code> (id‚Üístate) ‚Äî the latter enables
                                        state preservation via Echo.</li>
                                    <li><strong>Seed parsing:</strong> safe expression evaluation with
                                        <code>new Function()</code>
                                    </li>
                                </ul>

                                <div class="highlight-box purple">
                                    <strong>API:</strong> <code>init()</code>, <code>getState()</code>,
                                    <code>setState()</code>, <code>snapshot()</code>, <code>restore()</code>
                                </div>
                            </section>

                            <!-- Section 3: Signal -->
                            <section id="signal">
                                <h2>3. Signal ‚Äî Reactive Bindings</h2>

                                <div class="highlight-box">
                                    <strong>Mental Model:</strong> Signal is a bridge that reflects Cell state to the
                                    DOM. When state changes, the DOM updates automatically.
                                </div>

                                <p>Signal is Surf's most comprehensive module. It provides four directives:</p>

                                <ul>
                                    <li><code>d-signal</code> ‚Äî Triggers local state mutations (click, input, etc.)</li>
                                    <li><code>d-text</code> ‚Äî Binds element text to local state</li>
                                    <li><code>d-show</code> ‚Äî Conditional visibility (display: none toggle)</li>
                                    <li><code>d-attr</code> ‚Äî Attribute binding (class, disabled, etc.)</li>
                                </ul>

                                <h3>Usage Example: Counter</h3>

                                <div class="code-block">
                                    <div class="code-block-header">
                                        <span class="dot red"></span>
                                        <span class="dot yellow"></span>
                                        <span class="dot green"></span>
                                        HTML ‚Äî A Complete Interactive Widget
                                    </div>
                                    <pre><span class="tag">&lt;div</span> <span class="attr">d-cell</span>=<span class="string">"count: 0"</span> <span class="attr">d-id</span>=<span class="string">"counter"</span><span class="tag">&gt;</span>
  <span class="tag">&lt;span</span> <span class="attr">d-text</span>=<span class="string">"count"</span><span class="tag">&gt;</span>0<span class="tag">&lt;/span&gt;</span>

  <span class="tag">&lt;button</span> <span class="attr">d-signal</span>=<span class="string">"click: count = count + 1"</span><span class="tag">&gt;</span>+<span class="tag">&lt;/button&gt;</span>
  <span class="tag">&lt;button</span> <span class="attr">d-signal</span>=<span class="string">"click: count = Math.max(count - 1, 0)"</span><span class="tag">&gt;</span>‚àí<span class="tag">&lt;/button&gt;</span>

  <span class="tag">&lt;p</span> <span class="attr">d-show</span>=<span class="string">"count > 5"</span><span class="tag">&gt;</span>üéâ Greater than 5!<span class="tag">&lt;/p&gt;</span>
<span class="tag">&lt;/div&gt;</span></pre>
                                </div>

                                <h3>Expression Engine</h3>

                                <p>Signal has its own mini expression engine. It contains two main functions:
                                    <code>evaluate()</code> and <code>executeAssignment()</code>:
                                </p>

                                <div class="code-block">
                                    <div class="code-block-header">
                                        <span class="dot red"></span>
                                        <span class="dot yellow"></span>
                                        <span class="dot green"></span>
                                        signal.js ‚Äî Expression Examples
                                    </div>
                                    <pre><span class="comment">// evaluate() ‚Äî Reading (reading expressions)</span>
<span class="fn">evaluate</span>(<span class="string">"count"</span>, state)         <span class="comment">// ‚Üí state.count</span>
<span class="fn">evaluate</span>(<span class="string">"!open"</span>, state)          <span class="comment">// ‚Üí !state.open</span>
<span class="fn">evaluate</span>(<span class="string">"count > 5"</span>, state)      <span class="comment">// ‚Üí state.count > 5</span>

<span class="comment">// executeAssignment() ‚Äî Writing (writing expressions)</span>
<span class="fn">executeAssignment</span>(<span class="string">"count = count + 1"</span>)  <span class="comment">// ‚Üí { count: N+1 }</span>
<span class="fn">executeAssignment</span>(<span class="string">"open = !open"</span>)        <span class="comment">// ‚Üí { open: !current }</span>
<span class="fn">executeAssignment</span>(<span class="string">"Pulse.go('/page')"</span>)   <span class="comment">// ‚Üí module method call</span></pre>
                                </div>

                                <h3>Module Method Calls</h3>
                                <p>Signal can call methods of modules registered with <code>Surf.register()</code>. This
                                    is the key to connecting Cell's local state with server interactions:</p>

                                <div class="code-block">
                                    <div class="code-block-header">
                                        <span class="dot red"></span>
                                        <span class="dot yellow"></span>
                                        <span class="dot green"></span>
                                        HTML ‚Äî Signal + Module Integration
                                    </div>
                                    <pre><span class="comment">&lt;!-- After the Clipboard plugin is registered --&gt;</span>
<span class="tag">&lt;button</span> <span class="attr">d-signal</span>=<span class="string">"click: Clipboard.copy(event)"</span><span class="tag">&gt;</span>
  Copy
<span class="tag">&lt;/button&gt;</span></pre>
                                </div>

                                <div class="highlight-box purple">
                                    <strong>Binding Cycle:</strong> User Event ‚Üí <code>executeAssignment()</code> ‚Üí
                                    <code>Cell.setState()</code> ‚Üí <code>updateBindings()</code> ‚Üí DOM Updated
                                </div>
                            </section>

                            <!-- Section 4: Surface -->
                            <section id="surface">
                                <h2>4. Surface ‚Äî DOM Regions</h2>

                                <div class="highlight-box">
                                    <strong>Mental Model:</strong> A Surface is like a frame on a wall. The picture
                                    inside the frame changes, but the frame stays in place.
                                </div>

                                <p>Surfaces are DOM regions that can be <strong>replaced</strong> with HTML from the
                                    server. They are the foundation of Surf's server-driven nature.</p>

                                <div class="code-block">
                                    <div class="code-block-header">
                                        <span class="dot red"></span>
                                        <span class="dot yellow"></span>
                                        <span class="dot green"></span>
                                        HTML ‚Äî Surface Target
                                    </div>
                                    <pre><span class="tag">&lt;main</span> <span class="attr">id</span>=<span class="string">"content"</span><span class="tag">&gt;</span>
  <span class="comment">&lt;!-- The content of this region can be replaced with HTML from the server --&gt;</span>
  <span class="tag">&lt;h1&gt;</span>Welcome<span class="tag">&lt;/h1&gt;</span>
<span class="tag">&lt;/main&gt;</span></pre>
                                </div>

                                <h3>Replacement Modes</h3>

                                <p>Surface provides three different update modes:</p>
                                <ul>
                                    <li><strong>replace (inner):</strong> Completely replaces the content ‚Äî default mode
                                    </li>
                                    <li><strong>append:</strong> Appends to existing content ‚Äî ideal for infinite scroll
                                    </li>
                                    <li><strong>prepend:</strong> Prepends to existing content ‚Äî for new notifications
                                    </li>
                                </ul>

                                <h3>Smart Head Replacement</h3>
                                <p>In full page navigations (`target="html"`), Surface intelligently updates the `

                                    <head>` element. CSS links are compared ‚Äî identical ones are preserved, new ones
                                        added, old ones removed. This prevents <strong>CSS flicker</strong>.
                                </p>
                            </section>

                            <!-- Section 5: Patch -->
                            <section id="patch">
                                <h2>5. Patch ‚Äî Multi-Surface Updates</h2>

                                <div class="highlight-box">
                                    <strong>Mental Model:</strong> A Patch carries multiple letters in one envelope. A
                                    single server response can update multiple Surfaces.
                                </div>

                                <p>Patch is one of Surf's simplest yet most powerful features. The server can update
                                    multiple DOM regions in a single HTTP response:</p>

                                <div class="code-block">
                                    <div class="code-block-header">
                                        <span class="dot red"></span>
                                        <span class="dot yellow"></span>
                                        <span class="dot green"></span>
                                        Server Response ‚Äî Multi-Surface Patch
                                    </div>
                                    <pre><span class="tag">&lt;d-patch&gt;</span>
  <span class="tag">&lt;surface</span> <span class="attr">target</span>=<span class="string">"#main"</span><span class="tag">&gt;</span>
    <span class="tag">&lt;h1&gt;</span>Updated Content<span class="tag">&lt;/h1&gt;</span>
  <span class="tag">&lt;/surface&gt;</span>

  <span class="tag">&lt;surface</span> <span class="attr">target</span>=<span class="string">"#toast"</span><span class="tag">&gt;</span>
    <span class="tag">&lt;div</span> <span class="attr">class</span>=<span class="string">"notification"</span><span class="tag">&gt;</span>‚úÖ Saved!<span class="tag">&lt;/div&gt;</span>
  <span class="tag">&lt;/surface&gt;</span>
<span class="tag">&lt;/d-patch&gt;</span></pre>
                                </div>

                                <p>Patch module API consists of only 3 functions: <code>parse()</code>,
                                    <code>isPatch()</code>, and <code>create()</code>. Simplicity is power.
                                </p>
                            </section>

                            <!-- Section 6: Pulse -->
                            <section id="pulse">
                                <h2>6. Pulse ‚Äî Server Interactions</h2>

                                <div class="highlight-box">
                                    <strong>Mental Model:</strong> Pulse is a heart rate that communicates user intent
                                    to the server. Every click, every form submission is a Pulse.
                                </div>

                                <p>Pulse is Surf's most comprehensive module. It captures user interactions, sends them
                                    to the server, and applies the response to the appropriate Surfaces.</p>

                                <h3>Pulse Types</h3>

                                <div class="arch-grid">
                                    <div class="arch-card">
                                        <h4>navigate</h4>
                                        <p>GET request + history update. For link clicks.</p>
                                    </div>
                                    <div class="arch-card">
                                        <h4>commit</h4>
                                        <p>POST form data. Used for form submissions.</p>
                                    </div>
                                    <div class="arch-card">
                                        <h4>refresh</h4>
                                        <p>GET current URL. Refreshes surface content.</p>
                                    </div>
                                    <div class="arch-card">
                                        <h4>action</h4>
                                        <p>POST JSON data. Programmatic API calls.</p>
                                    </div>
                                </div>

                                <div class="code-block">
                                    <div class="code-block-header">
                                        <span class="dot red"></span>
                                        <span class="dot yellow"></span>
                                        <span class="dot green"></span>
                                        HTML ‚Äî Pulse Types
                                    </div>
                                    <pre><span class="comment">&lt;!-- Navigate: page change --&gt;</span>
<span class="tag">&lt;a</span> <span class="attr">href</span>=<span class="string">"/about"</span> <span class="attr">d-pulse</span>=<span class="string">"navigate"</span> <span class="attr">d-target</span>=<span class="string">"#main"</span><span class="tag">&gt;</span>About<span class="tag">&lt;/a&gt;</span>

<span class="comment">&lt;!-- Commit: form submission --&gt;</span>
<span class="tag">&lt;form</span> <span class="attr">action</span>=<span class="string">"/api/save"</span> <span class="attr">d-pulse</span>=<span class="string">"commit"</span> <span class="attr">d-target</span>=<span class="string">"#result"</span><span class="tag">&gt;</span>
  <span class="tag">&lt;input</span> <span class="attr">name</span>=<span class="string">"title"</span> <span class="tag">/&gt;</span>
  <span class="tag">&lt;button</span> <span class="attr">type</span>=<span class="string">"submit"</span><span class="tag">&gt;</span>Save<span class="tag">&lt;/button&gt;</span>
<span class="tag">&lt;/form&gt;</span>

<span class="comment">&lt;!-- Refresh: content refresh --&gt;</span>
<span class="tag">&lt;button</span> <span class="attr">d-pulse</span>=<span class="string">"refresh"</span> <span class="attr">d-target</span>=<span class="string">"#feed"</span><span class="tag">&gt;</span>‚Üª Refresh<span class="tag">&lt;/button&gt;</span></pre>
                                </div>

                                <h3>Request Flow</h3>
                                <div class="flow-diagram">
                                    <span class="module-name">User Event</span>
                                    <span class="arrow">‚Üí</span>
                                    <span class="module-name">Pulse.sendPulse()</span>
                                    <span class="arrow">‚Üí</span>
                                    <span class="module-name">fetch()</span>
                                    <span class="arrow">‚Üí</span>
                                    <span class="module-name">Server</span>
                                    <br>
                                    <span class="module-name">Server</span>
                                    <span class="arrow">‚Üí</span>
                                    <span class="module-name">HTML Response</span>
                                    <span class="arrow">‚Üí</span>
                                    <span class="module-name">Patch.isPatch()?</span>
                                    <span class="arrow">‚Üí</span>
                                    <span class="module-name">Echo + Surface.replace()</span>
                                </div>

                                <p>Every Pulse request automatically adds an `X-Surf-Request: true` header. The server
                                    uses this header to decide whether to return a full page or partial HTML.</p>
                            </section>

                            <!-- Section 7: Echo -->
                            <section id="echo">
                                <h2>7. Echo ‚Äî State Preservation</h2>

                                <div class="highlight-box">
                                    <strong>Mental Model:</strong> Echo is a photographer. Before a Surface updates, it
                                    takes a snapshot of all Cell states and restores them after the update.
                                </div>

                                <p>Echo is Surf's most elegant module ‚Äî consisting of only **3 functions** and **57
                                    lines** of code. Yet it fulfills the framework's core promise:
                                    <em>"Surface changes, Cell lives."</em>
                                </p>

                                <div class="code-block">
                                    <div class="code-block-header">
                                        <span class="dot red"></span>
                                        <span class="dot yellow"></span>
                                        <span class="dot green"></span>
                                        echo.js ‚Äî The Complete Module
                                    </div>
                                    <pre><span class="keyword">function</span> <span class="fn">withPreservation</span>(surface, replaceFn) {
  <span class="comment">// 1. Take snapshot: save all Cell states</span>
  <span class="keyword">const</span> snapshot = <span class="fn">before</span>(surface);

  <span class="comment">// 2. Change Surface (HTML replace)</span>
  <span class="fn">replaceFn</span>();

  <span class="comment">// 3. Restore snapshot: restore Cell states</span>
  <span class="fn">after</span>(surface, snapshot);
}

<span class="keyword">function</span> <span class="fn">before</span>(surface) {
  Signal.<span class="fn">cleanup</span>(surface);     <span class="comment">// Cleanup event listeners</span>
  <span class="keyword">return</span> Cell.<span class="fn">snapshot</span>(surface); <span class="comment">// Save states</span>
}

<span class="keyword">function</span> <span class="fn">after</span>(surface, snapshot) {
  Cell.<span class="fn">restore</span>(snapshot);       <span class="comment">// Restore states</span>
  Cell.<span class="fn">initAll</span>(surface);        <span class="comment">// Initialize new Cells</span>
  Signal.<span class="fn">initAll</span>(surface);      <span class="comment">// Rebind signals</span>
}</pre>
                                </div>

                                <p>For Echo to work, Cells must have an <strong>id</strong> or
                                    <strong>d-id</strong> attribute. This ID is used to match old and new
                                    elements.
                                </p>
                            </section>

                            <!-- Section 8: Surf -->
                            <section id="surf">
                                <h2>8. Surf ‚Äî The Orchestrator</h2>

                                <div class="highlight-box">
                                    <strong>Mental Model:</strong> Surf is an orchestra conductor. Each module plays its
                                    own instrument; Surf coordinates them all.
                                </div>

                                <p><code>surf.js</code> is the main file that combines all modules and provides the
                                    public API. Initialization order is critical:</p>

                                <div class="code-block">
                                    <div class="code-block-header">
                                        <span class="dot red"></span>
                                        <span class="dot yellow"></span>
                                        <span class="dot green"></span>
                                        surf.js ‚Äî Init Sequence
                                    </div>
                                    <pre><span class="keyword">function</span> <span class="fn">init</span>() {
  Surface.<span class="fn">init</span>();    <span class="comment">// 1. Mark surfaces (data-surf-ready)</span>
  Cell.<span class="fn">initAll</span>();     <span class="comment">// 2. Initialize all Cells (seed parse)</span>
  Signal.<span class="fn">initAll</span>();   <span class="comment">// 3. Bind signals and events</span>
  Pulse.<span class="fn">init</span>();      <span class="comment">// 4. Click/submit/popstate listeners</span>

  <span class="comment">// Make Pulse accessible from Signal</span>
  Signal.<span class="fn">register</span>(<span class="string">'Pulse'</span>, Pulse);
}</pre>
                                </div>

                                <h3>Public API</h3>
                                <ul>
                                    <li><code>Surf.go(url)</code> ‚Äî Programmatic navigation</li>
                                    <li><code>Surf.refresh(selector)</code> ‚Äî Surface refresh</li>
                                    <li><code>Surf.getState(cell)</code> / <code>Surf.setState(cell, state)</code> ‚Äî
                                        State management</li>
                                    <li><code>Surf.on(event, cb)</code> / <code>Surf.off(event, cb)</code> ‚Äî Lifecycle
                                        events</li>
                                    <li><code>Surf.register(name, module)</code> ‚Äî Module registration</li>
                                    <li><code>Surf.use(plugin)</code> ‚Äî Plugin installation</li>
                                </ul>
                            </section>

                            <!-- Section 9: Plugins -->
                            <section id="plugins">
                                <h2>9. Plugin System</h2>

                                <div class="highlight-box">
                                    <strong>Mental Model:</strong> Plugins are accessories attached to Surf. The core
                                    remains small, expanding as needed.
                                </div>

                                <p>Surf's plugin system is inspired by Vue.js. It has one rule: <strong>export an
                                        <code>install(Surf, options)</code> function.</strong></p>

                                <div class="code-block">
                                    <div class="code-block-header">
                                        <span class="dot red"></span>
                                        <span class="dot yellow"></span>
                                        <span class="dot green"></span>
                                        Plugin Anatomy
                                    </div>
                                    <pre><span class="keyword">const</span> <span class="const">MyPlugin</span> = {
  <span class="fn">install</span>(Surf, options) {
    <span class="comment">// 1. Register module ‚Äî make it accessible from Signal</span>
    Surf.<span class="fn">register</span>(<span class="string">'MyPlugin'</span>, {
      <span class="fn">doSomething</span>(event) {
        <span class="comment">// Plugin logic...</span>
        <span class="keyword">return</span> { result: <span class="string">'done'</span> }; <span class="comment">// ‚Üí Merged into Cell state</span>
      }
    });
  }
};

<span class="comment">// Usage</span>
Surf.<span class="fn">use</span>(MyPlugin, { <span class="comment">/* options */</span> });</pre>
                                </div>

                                <h3>Official Plugins</h3>
                                <ul>
                                    <li><strong>Clipboard:</strong> Copying + "Copied!" feedback + timeout reset</li>
                                    <li><strong>Auto-Refresh:</strong> Refreshing surfaces with polling at specific
                                        intervals</li>
                                    <li><strong>Drag & Drop:</strong> Server interaction via drag & drop</li>
                                </ul>

                                <p>The power of plugins comes from being connected to Signal via
                                    <code>Surf.register()</code>. This allows them to be called directly from HTML:
                                </p>

                                <div class="code-block">
                                    <div class="code-block-header">
                                        <span class="dot red"></span>
                                        <span class="dot yellow"></span>
                                        <span class="dot green"></span>
                                        HTML ‚Äî Plugin Usage
                                    </div>
                                    <pre><span class="comment">&lt;!-- Clipboard plugin ‚Äî calling directly from HTML --&gt;</span>
<span class="tag">&lt;div</span> <span class="attr">d-cell</span>=<span class="string">"copied: false"</span> <span class="attr">d-id</span>=<span class="string">"copy-demo"</span><span class="tag">&gt;</span>
  <span class="tag">&lt;code&gt;</span>npm install surf<span class="tag">&lt;/code&gt;</span>
  <span class="tag">&lt;button</span>
    <span class="attr">d-signal</span>=<span class="string">"click: Clipboard.copy(event)"</span>
    <span class="attr">d-attr</span>=<span class="string">"disabled: copied"</span><span class="tag">&gt;</span>
    Copy
  <span class="tag">&lt;/button&gt;</span>
<span class="tag">&lt;/div&gt;</span></pre>
                                </div>
                            </section>

                            <!-- Section 10: Data Flow -->
                            <section id="flow">
                                <h2>10. Data Flow: Putting It All Together</h2>

                                <p>Let's see how all of Surf's modules work together in a user interaction:</p>

                                <div class="module-card">
                                    <h4>Scenario: User clicks a link</h4>
                                    <pre
                                        style="color: var(--text-secondary); font-family: 'SF Mono', monospace; font-size: 0.85rem; line-height: 1.8; margin: 0.5rem 0 0;">
1. Pulse    ‚Üí captures click event (d-pulse="navigate")
2. Pulse    ‚Üí fetch('/about', { headers: X-Surf-Request })
3. Server   ‚Üí HTML response (or d-patch response)
4. Patch    ‚Üí determines response type with isPatch()
5. Echo     ‚Üí before(): snapshots Cell states
6. Surface  ‚Üí replace(): updates DOM with new HTML
7. Echo     ‚Üí after(): restores Cell states
8. Cell     ‚Üí initAll(): initializes new Cells
9. Signal   ‚Üí initAll(): binds signals and events
10. Pulse   ‚Üí history.pushState(): updates the URL</pre>
                                </div>

                                <div class="dep-graph">
                                    <div class="dep-graph-title">Module Dependency Graph</div>

                                    <!-- Top: Surf orchestrator -->
                                    <div class="dep-row">
                                        <span class="dep-node primary">üéØ Surf</span>
                                    </div>
                                    <div class="dep-label">orchestrates</div>
                                    <div class="dep-arrow down">‚Üì</div>

                                    <!-- Level 2: Pulse -->
                                    <div class="dep-row">
                                        <span class="dep-node">üíì Pulse</span>
                                    </div>
                                    <div class="dep-label">uses</div>
                                    <div class="dep-arrow down">‚Üì</div>

                                    <!-- Level 3: Echo + Patch side by side -->
                                    <div class="dep-row">
                                        <span class="dep-node">üîÑ Echo</span>
                                        <span style="color: var(--text-muted); margin: 0 0.75rem;">+</span>
                                        <span class="dep-node">üì¶ Patch</span>
                                    </div>
                                    <div class="dep-label">Echo snapshots Cell & Signal state</div>
                                    <div class="dep-arrow down">‚Üì</div>

                                    <!-- Level 4: Three branches -->
                                    <div class="dep-branches">
                                        <div class="dep-branch">
                                            <span class="dep-node">üß¨ Cell</span>
                                            <div class="dep-label">state store</div>
                                        </div>
                                        <div class="dep-branch">
                                            <span class="dep-node">‚ö° Signal</span>
                                            <div class="dep-label">bindings</div>
                                        </div>
                                        <div class="dep-branch">
                                            <span class="dep-node">üñºÔ∏è Surface</span>
                                            <div class="dep-label">DOM regions</div>
                                        </div>
                                    </div>

                                    <div
                                        style="text-align: center; margin-top: 0.75rem; display: flex; flex-direction: column; gap: 0.25rem; align-items: center;">
                                        <span
                                            style="color: var(--text-muted); font-size: 0.75rem; font-family: 'SF Mono', monospace;">Signal
                                            reads/writes ‚Üí Cell</span>
                                        <span
                                            style="color: var(--text-muted); font-size: 0.75rem; font-family: 'SF Mono', monospace;">Surface
                                            replaces ‚Üí DOM</span>
                                    </div>
                                </div>

                                <div class="quote-card">
                                    <blockquote>"Surf = 6 modules, each doing one thing. Together, they elegantly manage
                                        the full complexity of server-driven UI."</blockquote>
                                </div>
                            </section>

                        </article>
                    </div>
                </main>
    </div>

    <script src="/dist/surf.min.js"></script>
</body>

</html>